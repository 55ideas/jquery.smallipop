/*!
SmallIPop 0.1 (09/28/2011)
Copyright (c) 2011 Small Improvements (http://www.small-improvements.com)

Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.

@author Sebastian Helzle (sebastian@small-improvements.com)
*/
(function(a){a.smallipop={defaults:{popupOffset:31,popupYOffset:0,popupDistance:20,popupDelay:100,hideTrigger:false,theme:"default",infoClass:"smallipopHint",hideSpeed:150,moveSpeed:200},popup:null,lastId:1,hideSmallipop:function(){var e,b,d,c;b=a.smallipop;e=b.popup.data("shown");d=a(".smallipop"+e);c=d.data("options")||b.defaults;if(e&&c.hideTrigger){d.stop(true).fadeTo(c.hideSpeed,1)}return b.popup.data({hideDelayTimer:null,beingShown:false}).stop(true).animate({top:"-="+b.popup.data("distance")+"px",opacity:0},{duration:c.speed,step:b.func_ease,complete:function(){if(!a(this).data("beingShown")){return a(this).css("display","none").data("shown","")}}})},killTimers:function(){var c,b,d;b=a.smallipop.popup;c=b.data("hideDelayTimer");d=b.data("showDelayTimer");if(c){clearTimeout(c)}if(d){return clearTimeout(d)}},func_ease:function(f,g,e,i,h){if((g/=h/2)<1){return i/2*g*g+e}else{return -i/2*((--g)*(g-2)-1)+e}},triggerMouseover:function(){var g,f,c,d,e,b;d=a(this);g=d.data("id");b=a.smallipop;c=b.popup;e=c.data("shown");b.killTimers();c.data((g?"triggerHovered":"hovered"),true);if(g&&!c.data("beingShown")&&e!==g){f=d.data("options");return c.data("showDelayTimer",setTimeout(function(){var i,n,q,s,j,r,t,o,l,k,p,h,m;if(!c.data("triggerHovered")){return}l=a(".smallipop"+e);k=l.data("options")||b.defaults;if(e&&k.hideTrigger){l.stop(true).fadeTo(k.fadeSpeed,1)}p=a(window);i=f.popupDistance;m=f.popupYOffset;c.removeClass().addClass(f.theme).data({beingShown:true,shown:g}).find(".bubbleContent").html(d.data("hint")||d.find("."+f.infoClass).html());n=d.offset();s=c.outerHeight();q=c.outerWidth()/2;o=d.outerWidth();t=d.outerHeight();h=30;j=n.left+o/2;if(j+q>p.width()-h){j-=q*2-f.popupOffset;c.addClass("alignLeft")}else{if(j-q<h){j-=f.popupOffset;c.addClass("alignRight")}else{j-=q}}r=n.top-s+m;if(n.top-p.scrollTop()<s+f.popupDistance+h-m){r+=s+t;i=-i;m=0;c.addClass("alignBottom")}if(f.hideTrigger){a(".smallipop"+g).stop(true).fadeTo(f.hideSpeed,0)}return c.data("distance",i).stop(true).css({top:r,left:j,display:"block",opacity:0}).animate({top:"-="+i+"px",opacity:1},{duration:f.moveSpeed,step:b.func_ease,complete:function(){return c.data("beingShown",false)}})},f.popupDelay))}},triggerMouseout:function(){var e,c,d,b;d=a(this);b=a.smallipop;c=b.popup;e=d.data("id");b.killTimers();c.data((e?"triggerHovered":"hovered"),false);if(!(c.data("hovered")||c.data("triggerHovered"))){return c.data("hideDelayTimer",setTimeout(b.hideSmallipop,500))}}};return a.fn.smallipop=function(d,e){var c,b;if(d==null){d={}}if(e==null){e=""}b=a.smallipop;c=a("#smallipop");if(!c.length){c=b.popup=a('<div id="smallipop"><div class="bubbleContent"/><div class="bubbleArrowBorder"/><div class="bubbleArrow"/></div>').css("opacity",0).bind({mouseover:b.triggerMouseover,mouseout:b.triggerMouseout});a("body").append(c);a("a",c.get(0)).live("click",b.hideSmallipop)}return this.each(function(){var g,f;f=a(this);if(!f.hasClass("initialized")){b=a.smallipop;g=b.lastId++;f.addClass("initialized smallipop"+g).data({id:g,options:a.extend({},b.defaults,d),hint:e||f.attr("title")||""}).attr("title","").bind({mouseover:b.triggerMouseover,mouseout:b.triggerMouseout,click:b.hideSmallipop});return a("a",this).live("click",b.hideSmallipop)}})}})(jQuery);