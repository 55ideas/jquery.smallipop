/*!
SmallIPop 0.1 (09/28/2011)
Copyright (c) 2011 Small Improvements (http://www.small-improvements.com)

Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.

@author Sebastian Helzle (sebastian@small-improvements.com)
*/
(function(a){a.smallipop={defaults:{popupOffset:31,popupYOffset:0,popupDistance:20,hideTrigger:false,theme:"",infoClass:"info",hideSpeed:150,moveSpeed:200,centered:false},popup:null,lastId:1,hideBubbletip:function(){var e,b,d,c;b=a.smallipop;e=b.popup.data("shown");d=a(".smallipop"+e);c=d.data("options")||b.defaults;if(e&&c.hideTrigger){d.stop(true).fadeTo(c.hideSpeed,1)}return b.popup.data({hideDelayTimer:null,beingShown:false}).stop(true).animate({top:"-="+b.popup.data("distance")+"px",opacity:0},c.speed,"swing",function(){if(!a(this).data("beingShown")){return a(this).css("display","none").data("shown","")}})},triggerMouseover:function(){var b,d,k,e,c,p,f,o,g,q,n,m,i,h,l,j;q=a(this);d=q.data("id");m=a.smallipop;c=m.popup;n=c.data("shown");if(c.data("hideDelayTimer")){clearTimeout(c.data("hideDelayTimer"))}c.data((d?"triggerHovered":"hovered"),true);if(d&&!c.data("beingShown")&&n!==d){i=a(".smallipop"+n);h=i.data("options")||m.defaults;if(n&&h.hideTrigger){i.stop(true).fadeTo(h.fadeSpeed,1)}e=q.data("options");l=a(window);b=e.popupDistance;j=e.popupYOffset;c.removeClass().addClass(e.theme).data({beingShown:true,shown:d}).find(".bubbleContent").html(q.data("hint")||q.find("."+e.infoClass).html());k=q.offset();g=c.outerWidth();p=c.outerHeight();f=e.popupOffset-q.outerWidth()/2;if(e.centered){f+=g/2}else{if(k.left+g>l.width()-50){f=g-2*e.popupOffset;c.addClass("alignLeft")}}if(k.top-l.scrollTop()<p+e.popupDistance+50){o=-q.outerHeight();b=-b;j=0;c.addClass("alignBottom")}else{o=p}if(e.hideTrigger){a(".smallipop"+d).stop(true).fadeTo(e.hideSpeed,0)}return c.data("distance",b).stop(true).css({top:k.top-o+j,left:k.left-f,display:"block",opacity:0}).animate({top:"-="+b+"px",opacity:1},e.moveSpeed,"swing",function(){return c.data("beingShown",false)})}},triggerMouseout:function(){var e,c,d,b;d=a(this);b=a.smallipop;c=b.popup;e=d.data("id");if(c.data("hideDelayTimer")){clearTimeout(c.data("hideDelayTimer"))}c.data((!e?"hovered":"triggerHovered"),false);if(!(c.data("hovered")||c.data("triggerHovered"))){return c.data("hideDelayTimer",setTimeout(b.hideBubbletip,500))}}};return a.fn.smallipop=function(d,e){var c,b;if(d==null){d={}}if(e==null){e=""}b=a.smallipop;c=a("#infoBubble");if(!c.length){c=b.popup=a('<div id="infoBubble"><div class="bubbleContent"/><div class="bubbleArrowBorder"/><div class="bubbleArrow"/></div>').css("opacity",0).bind({mouseover:b.triggerMouseover,mouseout:b.triggerMouseout});a("body").append(c);a("a",c.get(0)).live("click",b.hideBubbletip)}return this.each(function(){var g,f;f=a(this);if(!f.hasClass("initialized")){b=a.smallipop;g=b.lastId++;f.addClass("initialized smallipop"+g).data({id:g,options:a.extend({},b.defaults,d),hint:e||f.attr("title")||""}).attr("title","").bind({mouseover:b.triggerMouseover,mouseout:b.triggerMouseout,click:b.hideBubbletip});return a("a",this).live("click",b.hideBubbletip)}})}})(jQuery);