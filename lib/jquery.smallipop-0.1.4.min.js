/*!
SmallIPop 0.1.4 (12/23/2011)
Copyright (c) 2011 Small Improvements (http://www.small-improvements.com)

Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.

@author Sebastian Helzle (sebastian@small-improvements.com)
*/
(function(a){a.smallipop={version:"0.1.4",defaults:{popupOffset:31,popupYOffset:0,popupDistance:20,popupDelay:100,hideTrigger:false,theme:"default",infoClass:"smallipopHint",triggerAnimationSpeed:150,popupAnimationSpeed:200,invertAnimation:false,horizontal:false,preferredPosition:"top"},popup:null,lastId:1,hideSmallipop:function(){var h,e,b,d,c,g,f;b=a.smallipop;e=b.popup.data("shown");d=a(".smallipop"+e);c=d.data("options")||b.defaults;if(e&&c.hideTrigger){d.stop(true).fadeTo(c.triggerAnimationSpeed,1)}h=c.invertAnimation?-1:1;g=b.popup.data("xDistance")*h;f=b.popup.data("yDistance")*h;return b.popup.data({hideDelayTimer:null,beingShown:false}).stop(true).animate({top:"-="+g+"px",left:"+="+f+"px",opacity:0},{duration:c.popupAnimationSpeed,step:b.func_ease,complete:function(){if(!a(this).data("beingShown")){return a(this).css("display","none").data("shown","")}}})},killTimers:function(){var c,b,d;b=a.smallipop.popup;c=b.data("hideDelayTimer");d=b.data("showDelayTimer");if(c){clearTimeout(c)}if(d){return clearTimeout(d)}},func_ease:function(f,g,e,i,h){if((g/=h/2)<1){return i/2*g*g+e}else{return -i/2*((--g)*(g-2)-1)+e}},triggerMouseover:function(){var g,f,c,d,e,b;d=a(this);g=d.data("id");b=a.smallipop;c=b.popup;e=c.data("shown");b.killTimers();c.data((g?"triggerHovered":"hovered"),true);if(g&&!c.data("beingShown")&&e!==g){f=d.data("options");return c.data("showDelayTimer",setTimeout(function(){var l,v,j,o,u,y,w,z,i,r,s,m,k,h,q,t,p,x,n;if(!c.data("triggerHovered")){return}s=a(".smallipop"+e);m=s.data("options")||b.defaults;if(e&&m.hideTrigger){s.stop(true).fadeTo(m.fadeSpeed,1)}c.removeClass().addClass(f.theme).data({beingShown:true,shown:g}).find(".sipContent").html(d.data("hint"));k=a(window);p=x=f.popupDistance;n=f.popupYOffset;l=d.offset();j=c.outerHeight();y=c.outerWidth();v=y/2;q=k.width();h=k.height();i=d.outerWidth();z=d.outerHeight();t=30;o=l.left+i/2;u=l.top-j+n;if(f.horizontal){p=0;u+=z/2+j/2;if((f.preferredPosition==="left"&&l.left-y-f.popupOffset>t)||l.left+i+y>q-t){c.addClass("sipPositionedLeft");o=l.left-y-f.popupOffset;x=-x}else{c.addClass("sipPositionedRight");o=l.left+i+f.popupOffset}}else{x=0;if(o+v>q-t){o-=v*2-f.popupOffset;c.addClass("sipAlignLeft")}else{if(o-v<t){o-=f.popupOffset;c.addClass("sipAlignRight")}else{o-=v}}r=l.top-k.scrollTop();w=j+f.popupDistance-n;if((f.preferredPosition==="bottom"&&r+z+w<h-t)||r-w<t){u+=j+z-2*n;p=-p;n=0;c.addClass("sipAlignBottom")}}if(f.hideTrigger){a(".smallipop"+g).stop(true).fadeTo(f.triggerAnimationSpeed,0)}return c.data({xDistance:p,yDistance:x}).stop(true).css({top:u,left:o,display:"block",opacity:0}).animate({top:"-="+p+"px",left:"+="+x+"px",opacity:1},{duration:f.popupAnimationSpeed,step:b.func_ease,complete:function(){return c.data("beingShown",false)}})},f.popupDelay))}},triggerMouseout:function(){var e,c,d,b;d=a(this);b=a.smallipop;c=b.popup;e=d.data("id");b.killTimers();c.data((e?"triggerHovered":"hovered"),false);if(!(c.data("hovered")||c.data("triggerHovered"))){return c.data("hideDelayTimer",setTimeout(b.hideSmallipop,500))}}};return a.fn.smallipop=function(d,e){var c,b;if(d==null){d={}}if(e==null){e=""}b=a.smallipop;d=a.extend({},b.defaults,d);if(d.moveSpeed!=null){d.popupAnimationSpeed=d.moveSpeed}if(d.hideSpeed!=null){d.triggerAnimationSpeed=d.hideSpeed}c=a("#smallipop");if(!c.length){c=b.popup=a('<div id="smallipop"><div class="sipContent"/><div class="sipArrowBorder"/><div class="sipArrow"/></div>').css("opacity",0).bind({mouseover:b.triggerMouseover,mouseout:b.triggerMouseout});a("body").append(c);a("a",c.get(0)).live("click",b.hideSmallipop)}return this.each(function(){var h,g,f;f=a(this);g=e||f.attr("title")||f.find("."+d.infoClass).html();if(g&&!f.hasClass("sipInitialized")){h=b.lastId++;f.addClass("sipInitialized smallipop"+h).data({id:h,options:d,hint:g}).attr("title","").bind({mouseover:b.triggerMouseover,mouseout:b.triggerMouseout,click:b.hideSmallipop});return a("a",this).live("click",b.hideSmallipop)}})}})(jQuery);